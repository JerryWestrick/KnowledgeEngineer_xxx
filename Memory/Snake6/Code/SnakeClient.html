<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Snake Game</title>
<style>
  /* Add your CSS styles here */
  body {
    font-family: 'Courier New', Courier, monospace;
    text-align: center;
  }
  #gameBoard {
    white-space: pre;
    font-size: 10px;
    line-height: 1;
    margin: auto;
    border: 1px solid black;
    width: 800px; /* Default size, but should be responsive */
    height: 800px;
    overflow: hidden;
    position: relative;
  }
  #statusBar {
    margin-top: 10px;
  }
</style>
<script>
  // Constants
  const BOARD_SIZE = 100;
  const SNAKE_CHARACTERS = ["\uD83D\uDD34", "\uD83D\uDD35", "\uD83D\uDFE0", "\uD83D\uDFE1", "\uD83D\uDFE2", "\uD83D\uDFE3", "\uD83D\uDFE4"];
  const FOOD_CHAR = "\uD83C\uDF4E";
  const FOOD_COUNT = 5;
  const DIRECTION = {
    "Stop": (0, 0),
    "Up": (0, -1),
    "Down": (0, 1),
    "Left": (-1, 0),
    "Right": (1, 0)
  };

  // Global variables
  let webSocket;
  let username;

  // Functions
  function initializeClient() {
    promptUsername();
  }

  function establishWebSocketConnection(url) {
    webSocket = new WebSocket(url);
    webSocket.onmessage = function(event) {
      handleMessage(JSON.parse(event.data));
    };
    webSocket.onerror = function(event) {
      handleError(event);
    };
  }

  function handleMessage(message) {
    switch (message.type) {
      case 'GameStatus':
        updateGameStatus(message);
        break;
      case 'SnakeDied':
        if (message.username === username) {
          showSnakeDiedDialog(username);
        }
        break;
      default:
        console.error('Unknown message type:', message.type);
    }
  }

  function promptUsername() {
    username = prompt('Enter your username:');
    if (username) {
      establishWebSocketConnection('ws://localhost:8080');
      webSocket.onopen = function() {
        webSocket.send(JSON.stringify({ type: 'Joining', username: username }));
      };
    }
  }

  function displayGameBoard(gameBoard) {
    const gameBoardElement = document.getElementById('gameBoard');
    gameBoardElement.textContent = gameBoard;
  }

  function updateStatusBar(clients) {
    const statusBarElement = document.getElementById('statusBar');
    statusBarElement.textContent = '';
    for (const [clientName, clientData] of Object.entries(clients)) {
      statusBarElement.textContent += `${clientData.char}${clientName}:${clientData.score} `;
    }
  }

  function detectArrowKeyPress(event) {
    const keyDirectionMap = {
      'ArrowUp': 'Up',
      'ArrowDown': 'Down',
      'ArrowLeft': 'Left',
      'ArrowRight': 'Right'
    };
    const direction = keyDirectionMap[event.key];
    if (direction) {
      webSocket.send(JSON.stringify({ type: 'DirectionChange', direction: direction }));
    }
  }

  function updateGameStatus(gameStatus) {
    displayGameBoard(gameStatus.game_board);
    updateStatusBar(gameStatus.clients);
  }

  function showSnakeDiedDialog(username) {
    alert(`${username}, your snake has died!`);
  }

  function handleError(error) {
    console.error('WebSocket error:', error);
  }

  function adjustLayoutForScreenSize() {
    // Adjust the layout for different screen sizes and devices
    // This function will be implemented with CSS media queries and JavaScript if necessary
  }

  // Event listeners
  document.addEventListener('DOMContentLoaded', initializeClient);
  document.addEventListener('keydown', detectArrowKeyPress);

  // Start the client
  initializeClient();
</script>
</head>
<body>
  <div id="gameBoard"></div>
  <div id="statusBar"></div>
</body>
</html>
